<main class="flex sm:h-screen sm:overflow-hidden bg-colorGray-300">
  @if (isMenuOpen) {
    <div
      class="fixed inset-0 bg-black/40 z-30 lg:hidden"
      (click)="closeMenu()"
    ></div>
  }

  <aside class="fixed lg:static top-0 left-0 z-40 h-full max-w-80 w-3/5 sm:w-2/3 lg:w-1/3 pt-12 px-9 pb-10 shadow-md bg-white flex flex-col items-center transform transition-transform duration-300 ease-in-out lg:translate-x-0 -translate-x-full"
    [class.translate-x-0]="isMenuOpen"
  >
    <div class="w-full pb-6 border-b border-colorGray-300">
      <img src="/assets/svg/logo.svg" alt="Logo" class="mx-auto w-[80%]" />
    </div>

    <nav class="flex-1 flex flex-col gap-4 pt-6 w-full">
      <a
        routerLink="/dashboard"
        routerLinkActive="active-component"
        (click)="closeMenu()"
        class="flex gap-2 items-center p-4 rounded-md text-colorGray-600 text-base outline-none hover:bg-colorGray-300 focus:outline-2 focus:outline-secondary duration-300 ease-in-out"
      >
        <img src="/assets/svg/dashboard-icon.svg" alt="" />
        Dashboard
      </a>

      <a
        routerLink="/pedidos"
        routerLinkActive="active-component"
        (click)="closeMenu()"
        class="flex gap-2 items-center p-4 rounded-md text-colorGray-600 text-base outline-none hover:bg-colorGray-300 focus:outline-2 focus:outline-secondary duration-300 ease-in-out"
      >
        <img src="/assets/svg/pedidos-icon.svg" alt="" />
        Pedidos
      </a>

      <a
        routerLink="/relatorios"
        routerLinkActive="active-component"
        (click)="closeMenu()"
        class="flex gap-2 items-center p-4 rounded-md text-colorGray-600 text-base outline-none hover:bg-colorGray-300 focus:outline-2 focus:outline-secondary duration-300 ease-in-out"
      >
        <img src="/assets/svg/relatorios-icon.svg" alt="" />
        Relatórios
      </a>

      <a
        routerLink="/perfil"
        routerLinkActive="active-component"
        (click)="closeMenu()"
        class="flex gap-2 items-center p-4 rounded-md text-colorGray-600 text-base outline-none hover:bg-colorGray-300 focus:outline-2 focus:outline-secondary duration-300 ease-in-out"
      >
        <img src="/assets/svg/perfil-icon.svg" alt="" />
        Perfil
      </a>
    </nav>

    <button
      class="hidden group lg:flex items-center gap-2 mt-auto -ml-5 py-2 px-4 rounded-lg self-start text-base text-colorGray-600 outline-none hover:text-secondary focus:outline-2 focus:outline-secondary duration-300 ease-in-out"
      (click)="logout()"
    >
      <i class="ph ph-sign-out text-lg"></i>
      <span class="group-hover:underline">Logout</span>
    </button>
  </aside>

  <!-- Botão menu para abrir aside -->
  <div class="absolute top-[22px] left-2">
    <button
      class="group relative lg:hidden py-1 px-2 rounded-lg text-secondary outline-none hover:bg-colorGray-600/40 focus:outline-2 focus:outline-secondary duration-300 ease-in-out"
      [disabled]="isMenuOpen"
      (click)="isMenuOpen = true"
    >
      <i
        class="ph ph-list text-2xl font-medium transition-transform duration-500 group-hover:translate-x-1 group-hover:opacity-0 group-focus:translate-x-1 group-focus:opacity-0"
      >
      </i>
      <i
        class="ph ph-arrow-fat-lines-right text-2xl font-medium absolute inset-0 flex items-center justify-center opacity-0 group-hover:opacity-100 group-focus:opacity-100 transition-opacity duration-500"
      >
      </i>
    </button>
  </div>

  @if (hasError) {
    <div class="flex flex-col items-center justify-center gap-6 w-full rounded-2xl shadow p-6 bg-white min-h-screen">
      <div class="text-center">
        <h2 class="text-lg font-semibold text-gray-800 mb-1">
          Não foi possível carregar os dados
        </h2>
  
        <p class="text-sm text-gray-500 text-center max-w-md">
          {{ errorMessage }}
        </p>
      </div>

      <button
        (click)="retry()"
        class="px-5 py-2 rounded-xl bg-primary text-white font-semibold hover:bg-secondary outline-none focus:outline-2 focus:outline-secondary duration-300 ease-in-out"
      >
        Tentar novamente
      </button>
    </div>
  } @else {
    <div class="flex-1 flex flex-col gap-6 p-6 w-full min-h-0">
      <!-- Header -->
      <header class="flex flex-col gap-9 sm:gap-6 md:justify-between">
        <div class="flex items-center justify-between">
          <div class="flex items-center gap-6 ml-6 lg:ml-0">
            <span class="text-sm text-colorGray-600 cursor-default"
              >pages <span class="text-secondary">/ Dashboard</span></span
            >
          </div>
  
          <button
            class="lg:hidden group flex items-center gap-2 py-1 px-2 my-auto rounded-lg self-start text-sm text-colorGray-600 outline-none hover:text-secondary focus:outline-2 focus:outline-secondary duration-300 ease-in-out"
            (click)="logout()"
          >
            <i class="ph ph-sign-out text-base"></i>
            <span class="group-hover:underline">Logout</span>
          </button>
        </div>

        <div class="flex items-center justify-end sm:justify-between gap-2">
          <h1 class="hidden sm:flex text-4xl font-bold font-montse text-gray-800">
            Bem vindo(a)!
          </h1>

          <app-period-filter
            [isLoading]="isLoading"
            [value]="period"
            (valueChange)="PeriodChange($event)"
          ></app-period-filter>
        </div>
      </header>

      <!-- KPIs -->
      <section class="grid grid-cols-1 gap-4 sm:grid-cols-3">
        <app-kpi-card
          cardTitle="Receita"
          cardValue="R$ {{ kpis.revenue.toFixed(2).replace('.', ',') }}"
          iconClass="ph ph-currency-dollar"
          [isLoading]="isLoading"
        >
        </app-kpi-card>

        <app-kpi-card
          cardTitle="Pedidos"
          cardValue="{{ kpis.ordersCount }}"
          iconClass="ph ph-list-checks "
          [isLoading]="isLoading"
        >
        </app-kpi-card>

        <app-kpi-card
          cardTitle="Ticket Médio"
          cardValue="R$ {{ kpis.avgTicket.toFixed(2).replace('.', ',') }}"
          iconClass="ph ph-chart-line-up"
          [isLoading]="isLoading"
        >
        </app-kpi-card>
      </section>

      <!-- Gráfico de linha -->
      <app-chart
        [chartData]="chartData"
        [isLoading]="isLoading"
      >
      </app-chart>

      <!-- Tabela de pedidos -->
      <app-orders-table
        [orders]="filteredOrders"
        [period]="period"
        [isLoading]="isLoading"
        class="flex-1 min-h-0"
        (search)="onSearch($event)"
        (sort)="onSortToggle()"
      >
      </app-orders-table>
    </div>
  }
</main>
